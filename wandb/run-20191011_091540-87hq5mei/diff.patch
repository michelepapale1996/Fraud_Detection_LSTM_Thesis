diff --git a/.idea/workspace.xml b/.idea/workspace.xml
index e836a9b..c574274 100644
--- a/.idea/workspace.xml
+++ b/.idea/workspace.xml
@@ -1,7 +1,16 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
   <component name="ChangeListManager">
-    <list default="true" id="782d7ebb-6452-46b8-84e4-cfc81e4c3351" name="Default" comment="" />
+    <list default="true" id="782d7ebb-6452-46b8-84e4-cfc81e4c3351" name="Default" comment="">
+      <change afterPath="$PROJECT_DIR$/LSTM_classifier.py" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/feature_engineering.py" afterDir="false" />
+      <change afterPath="$PROJECT_DIR$/metrics.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/Notebooks/bonifici_RF.ipynb" beforeDir="false" afterPath="$PROJECT_DIR$/Notebooks/bonifici_RF.ipynb" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/config.py" beforeDir="false" afterPath="$PROJECT_DIR$/config.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/main_LSTM.py" beforeDir="false" afterPath="$PROJECT_DIR$/LSTM_AD.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/models/LSTM.py" beforeDir="false" afterPath="$PROJECT_DIR$/models/LSTM.py" afterDir="false" />
+    </list>
     <option name="EXCLUDED_CONVERTED_TO_IGNORED" value="true" />
     <option name="TRACKING_ENABLED" value="true" />
     <option name="SHOW_DIALOG" value="false" />
@@ -10,16 +19,24 @@
     <option name="LAST_RESOLUTION" value="IGNORE" />
   </component>
   <component name="FileEditorManager">
-    <leaf>
-      <file leaf-file-name="config.py" pinned="false" current-in-tab="false">
-        <entry file="file://$PROJECT_DIR$/config.py">
-          <provider selected="true" editor-type-id="text-editor" />
+    <leaf SIDE_TABS_SIZE_LIMIT_KEY="300">
+      <file leaf-file-name="feature_engineering.py" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/feature_engineering.py">
+          <provider selected="true" editor-type-id="text-editor">
+            <state relative-caret-position="390">
+              <caret line="32" selection-start-line="32" selection-end-line="32" />
+              <folding>
+                <element signature="e#0#19#0" expanded="true" />
+              </folding>
+            </state>
+          </provider>
         </entry>
       </file>
-      <file leaf-file-name="main_LSTM.py" pinned="false" current-in-tab="true">
-        <entry file="file://$PROJECT_DIR$/main_LSTM.py">
+      <file leaf-file-name="LSTM_classifier.py" pinned="false" current-in-tab="true">
+        <entry file="file://$PROJECT_DIR$/LSTM_classifier.py">
           <provider selected="true" editor-type-id="text-editor">
-            <state relative-caret-position="-412">
+            <state relative-caret-position="307">
+              <caret line="49" column="56" selection-start-line="49" selection-start-column="56" selection-end-line="49" selection-end-column="56" />
               <folding>
                 <element signature="e#0#19#0" expanded="true" />
               </folding>
@@ -27,11 +44,69 @@
           </provider>
         </entry>
       </file>
+      <file leaf-file-name="metrics.py" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/metrics.py">
+          <provider selected="true" editor-type-id="text-editor">
+            <state relative-caret-position="75">
+              <caret line="5" column="61" selection-start-line="5" selection-start-column="61" selection-end-line="5" selection-end-column="61" />
+            </state>
+          </provider>
+        </entry>
+      </file>
+      <file leaf-file-name="LSTM.py" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/models/LSTM.py">
+          <provider selected="true" editor-type-id="text-editor">
+            <state relative-caret-position="675">
+              <caret line="56" column="13" selection-start-line="56" selection-start-column="13" selection-end-line="56" selection-end-column="13" />
+              <folding>
+                <element signature="e#0#11#0" expanded="true" />
+              </folding>
+            </state>
+          </provider>
+        </entry>
+      </file>
+      <file leaf-file-name="config.py" pinned="false" current-in-tab="false">
+        <entry file="file://$PROJECT_DIR$/config.py">
+          <provider selected="true" editor-type-id="text-editor">
+            <state relative-caret-position="90">
+              <caret line="6" column="95" selection-start-line="6" selection-start-column="28" selection-end-line="6" selection-end-column="95" />
+            </state>
+          </provider>
+        </entry>
+      </file>
     </leaf>
   </component>
+  <component name="FileTemplateManagerImpl">
+    <option name="RECENT_TEMPLATES">
+      <list>
+        <option value="Python Script" />
+      </list>
+    </option>
+  </component>
+  <component name="FindInProjectRecents">
+    <findStrings>
+      <find>datavaluta</find>
+      <find>indice</find>
+      <find>batch_siz</find>
+    </findStrings>
+  </component>
   <component name="Git.Settings">
     <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
   </component>
+  <component name="IdeDocumentHistory">
+    <option name="CHANGED_PATHS">
+      <list>
+        <option value="$PROJECT_DIR$/main_LSTM.py" />
+        <option value="$PROJECT_DIR$/LSTM_AD.py" />
+        <option value="$PROJECT_DIR$/LSTM_classificator.py" />
+        <option value="$PROJECT_DIR$/feature_engineering.py" />
+        <option value="$PROJECT_DIR$/config.py" />
+        <option value="$PROJECT_DIR$/metrics.py" />
+        <option value="$PROJECT_DIR$/models/LSTM.py" />
+        <option value="$PROJECT_DIR$/LSTM_classifier.py" />
+      </list>
+    </option>
+  </component>
   <component name="JsBuildToolGruntFileManager" detection-done="true" sorting="DEFINITION_ORDER" />
   <component name="JsBuildToolPackageJson" detection-done="true" sorting="DEFINITION_ORDER" />
   <component name="JsGulpfileManager">
@@ -41,16 +116,18 @@
   <component name="NodePackageJsonFileManager">
     <packageJsonPaths />
   </component>
-  <component name="ProjectFrameBounds">
-    <option name="y" value="23" />
-    <option name="width" value="1321" />
-    <option name="height" value="793" />
+  <component name="ProjectFrameBounds" fullScreen="true">
+    <option name="x" value="-94" />
+    <option name="y" value="-1080" />
+    <option name="width" value="1920" />
+    <option name="height" value="1080" />
   </component>
   <component name="ProjectView">
     <navigator proportions="" version="1">
       <foldersAlwaysOnTop value="true" />
     </navigator>
     <panes>
+      <pane id="Scope" />
       <pane id="ProjectPane">
         <subPane>
           <expand>
@@ -58,14 +135,19 @@
               <item name="Fraud_Detection_LSTM_Thesis" type="b2602c69:ProjectViewProjectNode" />
               <item name="Fraud_Detection_LSTM_Thesis" type="462c0819:PsiDirectoryNode" />
             </path>
+            <path>
+              <item name="Fraud_Detection_LSTM_Thesis" type="b2602c69:ProjectViewProjectNode" />
+              <item name="Fraud_Detection_LSTM_Thesis" type="462c0819:PsiDirectoryNode" />
+              <item name="datasets" type="462c0819:PsiDirectoryNode" />
+            </path>
           </expand>
           <select />
         </subPane>
       </pane>
-      <pane id="Scope" />
     </panes>
   </component>
   <component name="PropertiesComponent">
+    <property name="SearchEverywhereHistoryKey" value="&#9;FILE&#9;file:///Users/michele/Fraud_Detection_LSTM_Thesis/models/LSTM.py" />
     <property name="WebServerToolWindowFactoryState" value="false" />
     <property name="last_opened_file_path" value="$PROJECT_DIR$" />
     <property name="nodejs_interpreter_path.stuck_in_default_project" value="undefined stuck path" />
@@ -87,7 +169,26 @@
       </list>
     </option>
   </component>
-  <component name="RunManager">
+  <component name="RunManager" selected="Python.LSTM_classificator">
+    <configuration name="LSTM_classificator" type="PythonConfigurationType" factoryName="Python" temporary="true">
+      <module name="Fraud_Detection_LSTM_Thesis" />
+      <option name="INTERPRETER_OPTIONS" value="" />
+      <option name="PARENT_ENVS" value="true" />
+      <envs>
+        <env name="PYTHONUNBUFFERED" value="1" />
+      </envs>
+      <option name="SDK_HOME" value="" />
+      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
+      <option name="IS_MODULE_SDK" value="true" />
+      <option name="ADD_CONTENT_ROOTS" value="true" />
+      <option name="ADD_SOURCE_ROOTS" value="true" />
+      <EXTENSION ID="PythonCoverageRunConfigurationExtension" runner="coverage.py" />
+      <option name="SCRIPT_NAME" value="$PROJECT_DIR$/LSTM_classifier.py" />
+      <option name="PARAMETERS" value="" />
+      <option name="SHOW_COMMAND_LINE" value="true" />
+      <option name="EMULATE_TERMINAL" value="false" />
+      <option name="MODULE_MODE" value="false" />
+    </configuration>
     <configuration default="true" type="PythonConfigurationType" factoryName="Python">
       <module name="Fraud_Detection_LSTM_Thesis" />
       <option name="INTERPRETER_OPTIONS" value="" />
@@ -107,6 +208,77 @@
       <option name="EMULATE_TERMINAL" value="false" />
       <option name="MODULE_MODE" value="false" />
     </configuration>
+    <configuration name="feature_engineering" type="PythonConfigurationType" factoryName="Python" temporary="true">
+      <module name="Fraud_Detection_LSTM_Thesis" />
+      <option name="INTERPRETER_OPTIONS" value="" />
+      <option name="PARENT_ENVS" value="true" />
+      <envs>
+        <env name="PYTHONUNBUFFERED" value="1" />
+      </envs>
+      <option name="SDK_HOME" value="" />
+      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
+      <option name="IS_MODULE_SDK" value="true" />
+      <option name="ADD_CONTENT_ROOTS" value="true" />
+      <option name="ADD_SOURCE_ROOTS" value="true" />
+      <EXTENSION ID="PythonCoverageRunConfigurationExtension" runner="coverage.py" />
+      <option name="SCRIPT_NAME" value="$PROJECT_DIR$/feature_engineering.py" />
+      <option name="PARAMETERS" value="" />
+      <option name="SHOW_COMMAND_LINE" value="true" />
+      <option name="EMULATE_TERMINAL" value="false" />
+      <option name="MODULE_MODE" value="false" />
+    </configuration>
+    <configuration name="main_LSTM" type="PythonConfigurationType" factoryName="Python" temporary="true">
+      <module name="Fraud_Detection_LSTM_Thesis" />
+      <option name="INTERPRETER_OPTIONS" value="" />
+      <option name="PARENT_ENVS" value="true" />
+      <envs>
+        <env name="PYTHONUNBUFFERED" value="1" />
+      </envs>
+      <option name="SDK_HOME" value="" />
+      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
+      <option name="IS_MODULE_SDK" value="true" />
+      <option name="ADD_CONTENT_ROOTS" value="true" />
+      <option name="ADD_SOURCE_ROOTS" value="true" />
+      <EXTENSION ID="PythonCoverageRunConfigurationExtension" runner="coverage.py" />
+      <option name="SCRIPT_NAME" value="$PROJECT_DIR$/LSTM_AD.py" />
+      <option name="PARAMETERS" value="" />
+      <option name="SHOW_COMMAND_LINE" value="true" />
+      <option name="EMULATE_TERMINAL" value="false" />
+      <option name="MODULE_MODE" value="false" />
+    </configuration>
+    <configuration name="main_RF" type="PythonConfigurationType" factoryName="Python" temporary="true">
+      <module name="Fraud_Detection_LSTM_Thesis" />
+      <option name="INTERPRETER_OPTIONS" value="" />
+      <option name="PARENT_ENVS" value="true" />
+      <envs>
+        <env name="PYTHONUNBUFFERED" value="1" />
+      </envs>
+      <option name="SDK_HOME" value="" />
+      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
+      <option name="IS_MODULE_SDK" value="true" />
+      <option name="ADD_CONTENT_ROOTS" value="true" />
+      <option name="ADD_SOURCE_ROOTS" value="true" />
+      <EXTENSION ID="PythonCoverageRunConfigurationExtension" runner="coverage.py" />
+      <option name="SCRIPT_NAME" value="$PROJECT_DIR$/main_RF.py" />
+      <option name="PARAMETERS" value="" />
+      <option name="SHOW_COMMAND_LINE" value="true" />
+      <option name="EMULATE_TERMINAL" value="false" />
+      <option name="MODULE_MODE" value="false" />
+    </configuration>
+    <list>
+      <item itemvalue="Python.main_RF" />
+      <item itemvalue="Python.main_LSTM" />
+      <item itemvalue="Python.feature_engineering" />
+      <item itemvalue="Python.LSTM_classificator" />
+    </list>
+    <recent_temporary>
+      <list>
+        <item itemvalue="Python.LSTM_classificator" />
+        <item itemvalue="Python.feature_engineering" />
+        <item itemvalue="Python.main_LSTM" />
+        <item itemvalue="Python.main_RF" />
+      </list>
+    </recent_temporary>
   </component>
   <component name="SvnConfiguration">
     <configuration />
@@ -122,31 +294,55 @@
     <servers />
   </component>
   <component name="ToolWindowManager">
-    <frame x="0" y="23" width="1321" height="793" extended-state="0" />
+    <frame x="-94" y="-1080" width="1920" height="1080" extended-state="0" />
     <layout>
       <window_info anchor="bottom" id="TODO" order="6" />
-      <window_info anchor="bottom" id="Event Log" side_tool="true" />
-      <window_info anchor="right" x="0" y="0" width="280" height="593" id="Documentation" side_tool="true" weight="0.32994527" />
-      <window_info anchor="bottom" id="Database Changes" show_stripe_button="false" />
-      <window_info anchor="bottom" id="Run" order="2" />
-      <window_info anchor="bottom" id="Version Control" />
-      <window_info active="true" anchor="bottom" id="Python Console" visible="true" weight="0.32902297" />
-      <window_info anchor="bottom" id="Terminal" />
-      <window_info content_ui="combo" id="Project" order="0" visible="true" weight="0.13135262" />
-      <window_info anchor="bottom" id="Docker" show_stripe_button="false" />
-      <window_info anchor="right" id="Database" />
-      <window_info anchor="right" id="SciView" />
+      <window_info anchor="bottom" id="Event Log" order="7" side_tool="true" />
+      <window_info anchor="right" x="0" y="0" width="310" height="700" id="Documentation" order="5" side_tool="true" weight="0.21246007" />
+      <window_info anchor="bottom" id="Database Changes" order="7" show_stripe_button="false" />
+      <window_info anchor="bottom" id="Version Control" order="7" />
+      <window_info anchor="bottom" id="Python Console" order="7" weight="0.27636364" />
+      <window_info active="true" anchor="bottom" id="Run" order="2" visible="true" weight="0.37014925" />
+      <window_info anchor="bottom" id="Terminal" order="7" weight="0.32969698" />
+      <window_info content_ui="combo" id="Project" order="0" visible="true" weight="0.13258786" />
+      <window_info anchor="bottom" id="Docker" order="7" show_stripe_button="false" />
+      <window_info anchor="right" id="Database" order="3" />
+      <window_info anchor="right" id="SciView" order="4" weight="0.3297568" />
       <window_info id="Structure" order="1" side_tool="true" weight="0.25" />
+      <window_info id="Favorites" order="2" side_tool="true" />
       <window_info anchor="bottom" id="Debug" order="3" weight="0.4" />
-      <window_info id="Favorites" side_tool="true" />
-      <window_info anchor="bottom" id="Find" order="1" />
-      <window_info anchor="right" id="Commander" internal_type="SLIDING" order="0" type="SLIDING" weight="0.4" />
       <window_info anchor="right" content_ui="combo" id="Hierarchy" order="2" weight="0.25" />
       <window_info anchor="bottom" id="Inspection" order="5" weight="0.4" />
+      <window_info anchor="right" id="Commander" internal_type="SLIDING" order="0" type="SLIDING" weight="0.4" />
       <window_info anchor="right" id="Ant Build" order="1" weight="0.25" />
       <window_info anchor="bottom" id="Message" order="0" />
       <window_info anchor="bottom" id="Cvs" order="4" weight="0.25" />
+      <window_info anchor="bottom" id="Find" order="1" />
     </layout>
+    <layout-to-restore>
+      <window_info anchor="right" content_ui="combo" id="Hierarchy" order="2" weight="0.25" />
+      <window_info anchor="bottom" id="Docker" order="7" show_stripe_button="false" />
+      <window_info anchor="bottom" id="Inspection" order="5" weight="0.4" />
+      <window_info content_ui="combo" id="Project" order="0" visible="true" weight="0.123032905" />
+      <window_info id="Structure" order="1" side_tool="true" weight="0.25" />
+      <window_info anchor="right" id="Commander" internal_type="SLIDING" order="0" type="SLIDING" weight="0.4" />
+      <window_info anchor="right" id="Ant Build" order="1" weight="0.25" />
+      <window_info anchor="bottom" id="TODO" order="6" />
+      <window_info anchor="bottom" id="Version Control" order="8" />
+      <window_info anchor="bottom" id="Run" order="2" weight="0.4460606" />
+      <window_info anchor="bottom" id="Find" order="1" />
+      <window_info anchor="bottom" id="Python Console" order="10" weight="0.27636364" />
+      <window_info anchor="bottom" id="Debug" order="3" weight="0.4" />
+      <window_info anchor="right" x="0" y="0" width="310" height="700" id="Documentation" order="5" side_tool="true" weight="0.28540772" />
+      <window_info anchor="right" id="Database" order="3" />
+      <window_info anchor="bottom" id="Terminal" order="11" weight="0.32969698" />
+      <window_info anchor="bottom" id="Event Log" order="12" side_tool="true" />
+      <window_info anchor="bottom" id="Database Changes" order="9" show_stripe_button="false" />
+      <window_info anchor="bottom" id="Cvs" order="4" weight="0.25" />
+      <window_info anchor="right" id="SciView" order="4" />
+      <window_info anchor="bottom" id="Message" order="0" />
+      <window_info id="Favorites" order="2" side_tool="true" />
+    </layout-to-restore>
   </component>
   <component name="TypeScriptGeneratedFilesManager">
     <option name="version" value="1" />
@@ -154,13 +350,184 @@
   <component name="VcsContentAnnotationSettings">
     <option name="myLimit" value="2678400000" />
   </component>
+  <component name="XDebuggerManager">
+    <breakpoint-manager>
+      <option name="time" value="1" />
+    </breakpoint-manager>
+  </component>
   <component name="editorHistoryManager">
+    <entry file="file://$PROJECT_DIR$/feature_engineering.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="390">
+          <caret line="32" selection-start-line="32" selection-end-line="32" />
+          <folding>
+            <element signature="e#0#19#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/metrics.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="75">
+          <caret line="5" column="61" selection-start-line="5" selection-start-column="61" selection-end-line="5" selection-end-column="61" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/models/LSTM.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="675">
+          <caret line="56" column="13" selection-start-line="56" selection-start-column="13" selection-end-line="56" selection-end-column="13" />
+          <folding>
+            <element signature="e#0#11#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/config.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="90">
+          <caret line="6" column="95" selection-start-line="6" selection-start-column="28" selection-end-line="6" selection-end-column="95" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/LSTM_classifier.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="270">
+          <caret line="35" column="17" selection-start-line="35" selection-start-column="17" selection-end-line="35" selection-end-column="17" />
+          <folding>
+            <element signature="e#0#19#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/LSTM_AD.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="780">
+          <caret line="68" column="52" selection-start-line="68" selection-start-column="52" selection-end-line="68" selection-end-column="52" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/feature_engineering.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="390">
+          <caret line="32" selection-start-line="32" selection-end-line="32" />
+          <folding>
+            <element signature="e#0#19#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/models/LSTM.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="1125">
+          <caret line="86" column="138" selection-start-line="86" selection-start-column="138" selection-end-line="86" selection-end-column="138" />
+          <folding>
+            <element signature="e#0#11#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/config.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="195">
+          <caret line="13" column="44" selection-start-line="13" selection-start-column="44" selection-end-line="13" selection-end-column="44" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/LSTM_classifier.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="900">
+          <caret line="76" column="26" lean-forward="true" selection-start-line="76" selection-start-column="26" selection-end-line="76" selection-end-column="26" />
+          <folding>
+            <element signature="e#0#19#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/config.py">
+      <provider selected="true" editor-type-id="text-editor" />
+    </entry>
+    <entry file="file://$PROJECT_DIR$/models/LSTM.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="735">
+          <caret line="61" column="59" selection-start-line="61" selection-start-column="59" selection-end-line="61" selection-end-column="59" />
+          <folding>
+            <element signature="e#0#11#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/LSTM_AD.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="840">
+          <caret line="72" column="2" selection-start-line="72" selection-start-column="2" selection-end-line="72" selection-end-column="2" />
+        </state>
+      </provider>
+    </entry>
     <entry file="file://$PROJECT_DIR$/config.py">
       <provider selected="true" editor-type-id="text-editor" />
     </entry>
-    <entry file="file://$PROJECT_DIR$/main_LSTM.py">
+    <entry file="file://$PROJECT_DIR$/LSTM_AD.py">
+      <provider selected="true" editor-type-id="text-editor" />
+    </entry>
+    <entry file="file://$PROJECT_DIR$/visualization.py">
+      <provider selected="true" editor-type-id="text-editor" />
+    </entry>
+    <entry file="file://$PROJECT_DIR$/datasets/bonifici_engineered.csv">
+      <provider selected="true" editor-type-id="LargeFileEditor" />
+    </entry>
+    <entry file="file://$PROJECT_DIR$/LSTM_AD.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="780">
+          <caret line="68" column="52" selection-start-line="68" selection-start-column="52" selection-end-line="68" selection-end-column="52" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/config.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="90">
+          <caret line="6" column="95" selection-start-line="6" selection-start-column="28" selection-end-line="6" selection-end-column="95" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/metrics.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="75">
+          <caret line="5" column="61" selection-start-line="5" selection-start-column="61" selection-end-line="5" selection-end-column="61" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$USER_HOME$/PycharmProjects/varie/venv/lib/python3.6/site-packages/pandas/core/generic.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="104">
+          <caret line="10177" selection-start-line="10177" selection-end-line="10177" />
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/models/LSTM.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="675">
+          <caret line="56" column="13" selection-start-line="56" selection-start-column="13" selection-end-line="56" selection-end-column="13" />
+          <folding>
+            <element signature="e#0#11#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/feature_engineering.py">
+      <provider selected="true" editor-type-id="text-editor">
+        <state relative-caret-position="390">
+          <caret line="32" selection-start-line="32" selection-end-line="32" />
+          <folding>
+            <element signature="e#0#19#0" expanded="true" />
+          </folding>
+        </state>
+      </provider>
+    </entry>
+    <entry file="file://$PROJECT_DIR$/LSTM_classifier.py">
       <provider selected="true" editor-type-id="text-editor">
-        <state relative-caret-position="-412">
+        <state relative-caret-position="307">
+          <caret line="49" column="56" selection-start-line="49" selection-start-column="56" selection-end-line="49" selection-end-column="56" />
           <folding>
             <element signature="e#0#19#0" expanded="true" />
           </folding>
diff --git a/main_LSTM.py b/LSTM_AD.py
similarity index 69%
rename from main_LSTM.py
rename to LSTM_AD.py
index 6ee4d2b..2356ace 100644
--- a/main_LSTM.py
+++ b/LSTM_AD.py
@@ -13,6 +13,9 @@ from sklearn.metrics import roc_curve
 from sklearn.metrics import roc_auc_score
 from sklearn.metrics import precision_recall_curve
 from sklearn.model_selection import RandomizedSearchCV
+import wandb
+from wandb.keras import WandbCallback
+wandb.init(project="fraud-detection-thesis")
 
 # in order to print all the columns
 pd.set_option('display.max_columns', 100)
@@ -63,33 +66,8 @@ def create_dataset(dataset, look_back=1):
 
 
 # reading the datasets
-bonifici = pd.read_csv("datasets/quiubi_bonifici.csv")
-# dropping columns with useless data
-bonifici = bonifici.drop(["DataValuta", "DataEsecuzione", "CAP", "Servizio", "Status", "Paese", "Provincia", "Nazione", "IDTransazione", "CRO", "Causale", "Valuta", "ProfSicurezza", "NumConto", "ABI", "CAB", "Intestatario", "Indirizzo"], axis=1)
-bonifici = bonifici.drop(["MsgErrore", "Nominativo", "TipoOperazione"], axis=1)
-bonifici = bonifici[0:1000]
-# ------------------------------ Feature engineering ------------------------------
-print("Feature engineering")
-bonifici.Timestamp = pd.to_datetime(bonifici.Timestamp)
-
-bonifici.NumConfermaSMS = bonifici.NumConfermaSMS.eq('Si').astype(int)
-
-# rescaling "Importo"
-x = bonifici[["Importo"]].to_numpy()
-min_max_scaler = preprocessing.MinMaxScaler()
-x_scaled = min_max_scaler.fit_transform(x)
-bonifici[["Importo"]] = x_scaled
-
-# creating "isItalianSender" and "isItalianReceiver"
-bonifici.loc[:, "isItalianSender"] = np.ones(len(bonifici.index))
-bonifici.loc[:, "isItalianReceiver"] = np.ones(len(bonifici.index))
-for index, row in bonifici[["CC_ASN", "IBAN_CC"]].iterrows():
-    if row["CC_ASN"][:2] != "IT":
-        bonifici.at[index, "isItalianSender"] = 0
-    if row["IBAN_CC"] != "IT":
-        bonifici.at[index, "isItalianReceiver"] = 0
-bonifici["isItalianSender"] = pd.to_numeric(bonifici["isItalianSender"], downcast='integer')
-bonifici["isItalianReceiver"] = pd.to_numeric(bonifici["isItalianReceiver"], downcast='integer')
+bonifici = pd.read_csv("datasets/bonifici_engineered.csv")
+
 
 # --------------------------------- preparing training and test sets-----------------------------
 print("Preparing training and test sets")
@@ -97,8 +75,7 @@ print("Preparing training and test sets")
 bonifici = bonifici.drop(["IDSessione", "IP", "IBAN", "IBAN_CC", "CC_ASN"], axis=1)
 
 train, test = train_test_split(bonifici, test_size=0.1)
-x_train, y_train = create_dataset(train, look_back=50)
-
+x_train, y_train = create_dataset(train, look_back=20)
 x_test, y_test = create_dataset(test, look_back=20)
 
 look_back = cfg.multi_step_lstm_config['look_back']
diff --git a/LSTM_classifier.py b/LSTM_classifier.py
new file mode 100644
index 0000000..cfcc78d
--- /dev/null
+++ b/LSTM_classifier.py
@@ -0,0 +1,157 @@
+import pandas as pd
+import numpy as np
+from sklearn import preprocessing
+import seaborn as sns
+import matplotlib.pyplot as plt
+# seaborn can generate several warnings, we ignore them
+import warnings
+from sklearn.model_selection import TimeSeriesSplit
+from metrics import f1_m, precision_m, recall_m
+from models import LSTM
+
+import config as cfg
+from sklearn.metrics import f1_score
+from sklearn.metrics import roc_curve
+from sklearn.metrics import roc_auc_score
+from sklearn.metrics import precision_recall_curve
+import wandb
+from wandb.keras import WandbCallback
+
+wandb.init(project="fraud-detection-thesis")
+
+# in order to print all the columns
+pd.set_option('display.max_columns', 100)
+sns.set(style="white", color_codes=True)
+sns.set_context(rc={"font.family": 'sans', "font.size": 24, "axes.titlesize": 24, "axes.labelsize": 24})
+warnings.filterwarnings("ignore")
+
+# -----------------------------------------------------------------------------------------------
+# --------------------------Main idea: creating an LSTM classifier ------------------------------
+# -----------------------------------------------------------------------------------------------
+
+# experiments
+repeats = 2
+epochs = [3]
+look_backs = [400]
+batch_size = [1, 5]
+layers = [{'input': 10, 'hidden1': 10, 'hidden2': 10, 'output': 1}]
+
+
+# creates samples starting by the sequence of transactions of a given user
+# NB: only the last transaction of a sequence can be a fraud
+def get_sequences(transactions, look_back):
+    sequence = []
+    sequences = []
+    label_sequences = []
+
+    pointer = 0
+    while pointer + 1 < len(transactions.index):
+        print(len(transactions.index))
+        pointer = 0
+        while pointer < look_back:
+            print(transactions.iloc[pointer: pointer + 1]["isFraud"].values)
+            if transactions.iloc[pointer: pointer + 1]["isFraud"].values[0] == 0:
+                sequence.append(transactions[pointer: pointer + 1])
+
+            pointer += 1
+
+        sequence.append(transactions[pointer: pointer + 1])
+        sequences.append(sequence)
+        transactions = transactions[pointer:]
+
+    return sequence, label_sequences
+
+
+# converting low level dataset (transactions of all users)
+# to high level (sequences of transactions with at least length = look_back + 1)
+def create_dataset(dataset, look_back=1):
+    print("Creating samples using as look_back = " + str(look_back))
+    bonifici_by_user = dataset.groupby("UserID")
+    x = []
+    y = []
+
+    # un utente è valido se ha più di lookback transazioni
+    number_of_sequences = 0
+    number_of_users = 0
+    for user in bonifici_by_user.groups.keys():
+        transactions = bonifici_by_user.get_group(user).sort_values("Timestamp")
+        transactions = transactions.drop(["UserID", "Timestamp"], axis=1)
+        sequence_x, sequence_y = get_sequences(transactions, look_back)
+        x.extend(sequence_x)
+        y.extend(sequence_y)
+
+        number_of_users += 1
+        number_of_sequences += len(sequence_y)
+
+    print("There are " + str(number_of_sequences) + " sequences with " + str(number_of_users) + " users.")
+    return np.asarray(x), np.asarray(y)
+
+
+def create_dataset_for_single_user(dataset, look_back=1):
+    print("Creating samples using as look_back = " + str(look_back))
+    # take the transactions of the user with most transactions
+    transactions = dataset.loc[dataset["UserID"] == "079fee0af27f1d2a688020b0dc34d9b4"].sort_values("Timestamp")
+
+    transactions = transactions.drop(["UserID", "Timestamp"], axis=1)
+    sequence_x, sequence_y = get_sequences(transactions, look_back)
+
+    # return np.asarray(sequence_x), np.asarray(sequence_y)
+    return sequence_x, sequence_y
+
+
+# run a repeated experiment with a fixed:
+# - the experiment is repeated repeats times
+# - number of epochs
+# - sequence length = look_back
+def experiment(dataset, repeats, epochs, look_back):
+    # x, y = create_dataset(dataset, look_back)
+    x, y = create_dataset(dataset, look_back)
+    report = pd.DataFrame([], columns=['Loss', 'Accuracy', 'F1_score', 'Precision', 'Recall'])
+    tscv = TimeSeriesSplit(n_splits=3)
+    for train_index, test_index in tscv.split(x):
+        x_train, x_test = x[train_index], x[test_index]
+        y_train, y_test = y[train_index], y[test_index]
+
+        '''
+        for r in range(repeats):
+            print("--------------------------------------------------")
+            print("Current iteration: " + str(r))
+            print("Current number of epochs: " + str(epochs))
+            print("Current number of look_backs: " + str(look_back))
+            print("Current train size: " + str(x_train.shape))
+            print("Current test size: " + str(x_test.shape))
+
+            lstm_classifier = LSTM.LstmClassifier(
+                look_back=look_back,
+                layers=layers[0],
+                dropout=0,
+                loss='binary_crossentropy',
+                learning_rate=0.01,
+                num_features=x_train.shape[2],
+                metrics=['acc', f1_m, precision_m, recall_m])
+            model = lstm_classifier.build_model()
+
+            LSTM.train_model(model=model, x_train=x_train, y_train=y_train, batch_size=batch_size, epochs=epochs, shuffle=False)
+            loss, accuracy, f1_score, precision, recall = model.evaluate(x_test, y_test, verbose=0)
+            print(loss, accuracy, f1_score, precision, recall)
+            report = report.append({'Loss': loss, 'Accuracy': accuracy, 'F1_score': f1_score, 'Precision': precision, 'Recall': recall}, ignore_index=True)
+        '''
+    return report
+
+
+print("Preparing training and test sets...")
+# reading the datasets
+bonifici = pd.read_csv("datasets/bonifici_engineered.csv", parse_dates=True)
+bonifici.set_index('indice', inplace=True)
+bonifici = bonifici.drop(["IDSessione", "IP", "IBAN", "IBAN_CC", "CC_ASN"], axis=1)
+
+create_dataset_for_single_user(bonifici, 5)
+'''
+results = pd.DataFrame([], columns=['Loss', 'Accuracy', 'F1_score', 'Precision', 'Recall'])
+for e in epochs:
+    for l in look_backs:
+        results.append(experiment(bonifici, repeats, e, l))
+
+# summarize results
+print(results.describe())
+'''
\ No newline at end of file
diff --git a/Notebooks/bonifici_RF.ipynb b/Notebooks/bonifici_RF.ipynb
index ef11002..dbee61c 100644
--- a/Notebooks/bonifici_RF.ipynb
+++ b/Notebooks/bonifici_RF.ipynb
@@ -145,227 +145,6 @@
     "x_scaled = min_max_scaler.fit_transform(x)\n",
     "bonifici[[\"Importo\"]] = x_scaled"
    ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": 459,
-   "metadata": {},
-   "outputs": [],
-   "source": [
-    "# Labels are the values we want to predict\n",
-    "labels = np.array(bonifici['isFraud'])\n",
-    "# Remove the labels from the features\n",
-    "bonifici = bonifici[[\"Importo\", \"NumConfermaSMS\"]]\n",
-    "# Saving feature names for later use\n",
-    "feature_list = [\"Importo\", \"NumConfermaSMS\"]\n",
-    "# Convert to numpy array\n",
-    "features = np.array(bonifici)"
-   ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": 460,
-   "metadata": {},
-   "outputs": [],
-   "source": [
-    "train_features, test_features, train_labels, test_labels = train_test_split(features, labels, test_size = 0.25, random_state = 42)"
-   ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": 461,
-   "metadata": {},
-   "outputs": [
-    {
-     "name": "stdout",
-     "output_type": "stream",
-     "text": [
-      "Training Features Shape: (362181, 2)\n",
-      "Training Labels Shape: (362181,)\n",
-      "Testing Features Shape: (120727, 2)\n",
-      "Testing Labels Shape: (120727,)\n"
-     ]
-    }
-   ],
-   "source": [
-    "print('Training Features Shape:', train_features.shape)\n",
-    "print('Training Labels Shape:', train_labels.shape)\n",
-    "print('Testing Features Shape:', test_features.shape)\n",
-    "print('Testing Labels Shape:', test_labels.shape)"
-   ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": 462,
-   "metadata": {},
-   "outputs": [],
-   "source": [
-    "# Instantiate model with 1000 decision trees\n",
-    "rf = RandomForestRegressor(n_estimators = 1000, random_state = 42)\n",
-    "# Train the model on training data\n",
-    "rf.fit(train_features, train_labels);"
-   ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": 463,
-   "metadata": {},
-   "outputs": [
-    {
-     "data": {
-      "text/plain": [
-       "array([0.        , 0.00016463, 0.        , ..., 0.        , 0.00016463,\n",
-       "       0.        ])"
-      ]
-     },
-     "execution_count": 463,
-     "metadata": {},
-     "output_type": "execute_result"
-    }
-   ],
-   "source": [
-    "rf.predict(test_features)"
-   ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": 9,
-   "metadata": {},
-   "outputs": [
-    {
-     "name": "stdout",
-     "output_type": "stream",
-     "text": [
-      "[array([112., 118.], dtype=float32), array([118., 132.], dtype=float32), array([132., 129.], dtype=float32), array([129., 121.], dtype=float32), array([121., 135.], dtype=float32), array([135., 148.], dtype=float32), array([148., 148.], dtype=float32), array([148., 136.], dtype=float32), array([136., 119.], dtype=float32), array([119., 104.], dtype=float32), array([104., 118.], dtype=float32), array([118., 115.], dtype=float32), array([115., 126.], dtype=float32), array([126., 141.], dtype=float32), array([141., 135.], dtype=float32), array([135., 125.], dtype=float32), array([125., 149.], dtype=float32), array([149., 170.], dtype=float32), array([170., 170.], dtype=float32), array([170., 158.], dtype=float32), array([158., 133.], dtype=float32), array([133., 114.], dtype=float32), array([114., 140.], dtype=float32), array([140., 145.], dtype=float32), array([145., 150.], dtype=float32), array([150., 178.], dtype=float32), array([178., 163.], dtype=float32), array([163., 172.], dtype=float32), array([172., 178.], dtype=float32), array([178., 199.], dtype=float32), array([199., 199.], dtype=float32), array([199., 184.], dtype=float32), array([184., 162.], dtype=float32), array([162., 146.], dtype=float32), array([146., 166.], dtype=float32), array([166., 171.], dtype=float32), array([171., 180.], dtype=float32), array([180., 193.], dtype=float32), array([193., 181.], dtype=float32), array([181., 183.], dtype=float32), array([183., 218.], dtype=float32), array([218., 230.], dtype=float32), array([230., 242.], dtype=float32), array([242., 209.], dtype=float32), array([209., 191.], dtype=float32), array([191., 172.], dtype=float32), array([172., 194.], dtype=float32), array([194., 196.], dtype=float32), array([196., 196.], dtype=float32), array([196., 236.], dtype=float32), array([236., 235.], dtype=float32), array([235., 229.], dtype=float32), array([229., 243.], dtype=float32), array([243., 264.], dtype=float32), array([264., 272.], dtype=float32), array([272., 237.], dtype=float32), array([237., 211.], dtype=float32), array([211., 180.], dtype=float32), array([180., 201.], dtype=float32), array([201., 204.], dtype=float32), array([204., 188.], dtype=float32), array([188., 235.], dtype=float32), array([235., 227.], dtype=float32), array([227., 234.], dtype=float32), array([234., 264.], dtype=float32), array([264., 302.], dtype=float32), array([302., 293.], dtype=float32), array([293., 259.], dtype=float32), array([259., 229.], dtype=float32), array([229., 203.], dtype=float32), array([203., 229.], dtype=float32), array([229., 242.], dtype=float32), array([242., 233.], dtype=float32), array([233., 267.], dtype=float32), array([267., 269.], dtype=float32), array([269., 270.], dtype=float32), array([270., 315.], dtype=float32), array([315., 364.], dtype=float32), array([364., 347.], dtype=float32), array([347., 312.], dtype=float32), array([312., 274.], dtype=float32), array([274., 237.], dtype=float32), array([237., 278.], dtype=float32), array([278., 284.], dtype=float32), array([284., 277.], dtype=float32), array([277., 317.], dtype=float32), array([317., 313.], dtype=float32), array([313., 318.], dtype=float32), array([318., 374.], dtype=float32), array([374., 413.], dtype=float32), array([413., 405.], dtype=float32), array([405., 355.], dtype=float32), array([355., 306.], dtype=float32)]\n",
-      "---------------\n",
-      "[132.0, 129.0, 121.0, 135.0, 148.0, 148.0, 136.0, 119.0, 104.0, 118.0, 115.0, 126.0, 141.0, 135.0, 125.0, 149.0, 170.0, 170.0, 158.0, 133.0, 114.0, 140.0, 145.0, 150.0, 178.0, 163.0, 172.0, 178.0, 199.0, 199.0, 184.0, 162.0, 146.0, 166.0, 171.0, 180.0, 193.0, 181.0, 183.0, 218.0, 230.0, 242.0, 209.0, 191.0, 172.0, 194.0, 196.0, 196.0, 236.0, 235.0, 229.0, 243.0, 264.0, 272.0, 237.0, 211.0, 180.0, 201.0, 204.0, 188.0, 235.0, 227.0, 234.0, 264.0, 302.0, 293.0, 259.0, 229.0, 203.0, 229.0, 242.0, 233.0, 267.0, 269.0, 270.0, 315.0, 364.0, 347.0, 312.0, 274.0, 237.0, 278.0, 284.0, 277.0, 317.0, 313.0, 318.0, 374.0, 413.0, 405.0, 355.0, 306.0, 271.0]\n",
-      "[array([315., 301.], dtype=float32), array([301., 356.], dtype=float32), array([356., 348.], dtype=float32), array([348., 355.], dtype=float32), array([355., 422.], dtype=float32), array([422., 465.], dtype=float32), array([465., 467.], dtype=float32), array([467., 404.], dtype=float32), array([404., 347.], dtype=float32), array([347., 305.], dtype=float32), array([305., 336.], dtype=float32), array([336., 340.], dtype=float32), array([340., 318.], dtype=float32), array([318., 362.], dtype=float32), array([362., 348.], dtype=float32), array([348., 363.], dtype=float32), array([363., 435.], dtype=float32), array([435., 491.], dtype=float32), array([491., 505.], dtype=float32), array([505., 404.], dtype=float32), array([404., 359.], dtype=float32), array([359., 310.], dtype=float32), array([310., 337.], dtype=float32), array([337., 360.], dtype=float32), array([360., 342.], dtype=float32), array([342., 406.], dtype=float32), array([406., 396.], dtype=float32), array([396., 420.], dtype=float32), array([420., 472.], dtype=float32), array([472., 548.], dtype=float32), array([548., 559.], dtype=float32), array([559., 463.], dtype=float32), array([463., 407.], dtype=float32), array([407., 362.], dtype=float32), array([362., 405.], dtype=float32), array([405., 417.], dtype=float32), array([417., 391.], dtype=float32), array([391., 419.], dtype=float32), array([419., 461.], dtype=float32), array([461., 472.], dtype=float32), array([472., 535.], dtype=float32), array([535., 622.], dtype=float32), array([622., 606.], dtype=float32), array([606., 508.], dtype=float32), array([508., 461.], dtype=float32)]\n",
-      "---------------\n",
-      "[356.0, 348.0, 355.0, 422.0, 465.0, 467.0, 404.0, 347.0, 305.0, 336.0, 340.0, 318.0, 362.0, 348.0, 363.0, 435.0, 491.0, 505.0, 404.0, 359.0, 310.0, 337.0, 360.0, 342.0, 406.0, 396.0, 420.0, 472.0, 548.0, 559.0, 463.0, 407.0, 362.0, 405.0, 417.0, 391.0, 419.0, 461.0, 472.0, 535.0, 622.0, 606.0, 508.0, 461.0, 390.0]\n"
-     ]
-    }
-   ],
-   "source": [
-    "# LSTM for international airline passengers problem with time step regression framing\n",
-    "import numpy\n",
-    "import matplotlib.pyplot as plt\n",
-    "from pandas import read_csv\n",
-    "import math\n",
-    "from sklearn.preprocessing import MinMaxScaler\n",
-    "from sklearn.metrics import mean_squared_error\n",
-    "\n",
-    "\n",
-    "# convert an array of values into a dataset matrix\n",
-    "def create_dataset(dataset, look_back=1):\n",
-    "    dataX, dataY = [], []\n",
-    "    for i in range(len(dataset)-look_back-1):\n",
-    "        a = dataset[i:(i+look_back), 0]\n",
-    "        dataX.append(a)\n",
-    "        dataY.append(dataset[i + look_back, 0])\n",
-    "    print(dataX)\n",
-    "    print(\"---------------\")\n",
-    "    print(dataY)\n",
-    "    return numpy.array(dataX), numpy.array(dataY)\n",
-    "\n",
-    "\n",
-    "# fix random seed for reproducibility\n",
-    "numpy.random.seed(7)\n",
-    "# load the dataset\n",
-    "dataframe = read_csv('datasets/airline-passengers.csv', usecols=[1], engine='python')\n",
-    "dataset = dataframe.values\n",
-    "dataset = dataset.astype('float32')\n",
-    "# normalize the dataset\n",
-    "# split into train and test sets\n",
-    "train_size = int(len(dataset) * 0.67)\n",
-    "test_size = len(dataset) - train_size\n",
-    "train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]\n",
-    "# reshape into X=t and Y=t+1\n",
-    "look_back = 2\n",
-    "trainX, trainY = create_dataset(train, look_back)\n",
-    "testX, testY = create_dataset(test, look_back)\n",
-    "# reshape input to be [samples, time steps, features]\n",
-    "trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))\n",
-    "testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))"
-   ]
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {
-    "collapsed": true
-   },
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
-  },
-  {
-   "cell_type": "code",
-   "execution_count": null,
-   "metadata": {},
-   "outputs": [],
-   "source": []
   }
  ],
  "metadata": {
diff --git a/config.py b/config.py
index 198b5d3..a3a1d2c 100644
--- a/config.py
+++ b/config.py
@@ -3,14 +3,15 @@ multi_step_lstm_config = {  'batch_size': 256,
                             'dropout': 0.1,
                             'look_back': 20,
                             'look_ahead': 1,
-                            #'layers':{'input': 1, 'hidden1':20, 'hidden2':5,  'output': 1},
-                            #'layers':{'input': 1, 'hidden1': 200, 'hidden2': 80, 'hidden3': 40, 'hidden4': 10,'output': 1},
-                            'layers': {'input': 4, 'hidden1': 16, 'output': 4},
+                            # 'layers':{'input': 1, 'hidden1':20, 'hidden2':5,  'output': 1},
+                            'layers': {'input': 50, 'hidden1': 50, 'hidden2': 50, 'output': 1},
                             'loss': 'mse',
-                            #'optimizer': 'adam',
+                            'metrics': ["accuracy"],
+                            # 'optimizer': 'adam',
                             'train_test_ratio': 0.7,
+                            'train_validation_ratio': 0.2,
                             'shuffle': False,
                             'validation': False,
                             'learning_rate': .02,
-                            'patience':20,
+                            'patience': 20,
                            }
\ No newline at end of file
diff --git a/feature_engineering.py b/feature_engineering.py
new file mode 100644
index 0000000..d337b5b
--- /dev/null
+++ b/feature_engineering.py
@@ -0,0 +1,65 @@
+import pandas as pd
+import numpy as np
+from sklearn import preprocessing
+import seaborn as sns
+import matplotlib.pyplot as plt
+# seaborn can generate several warnings, we ignore them
+import warnings
+warnings.filterwarnings("ignore")
+from sklearn.model_selection import train_test_split
+
+# in order to print all the columns
+pd.set_option('display.max_columns', 100)
+sns.set(style="white", color_codes=True)
+sns.set_context(rc={"font.family":'sans',"font.size":24,"axes.titlesize":24,"axes.labelsize":24})
+
+
+# -----------------------------------------------------------------------------------------------
+# -------------------------- Feature engineering module -----------------------------------------
+# -----------------------------------------------------------------------------------------------
+
+# reading the datasets
+bonifici = pd.read_csv("datasets/quiubi_bonifici.csv")
+segnalaz = pd.read_csv("datasets/bonifici_segnalaz.csv")
+bonifici.set_index('indice',inplace=True)
+segnalaz.set_index('indice',inplace=True)
+
+# dropping columns with useless data
+useless_features = ["CAP", "Servizio", "Status", "Paese", "Provincia", "Nazione", "IDTransazione", "CRO", "Causale", "Valuta", "ProfSicurezza", "NumConto", "ABI", "CAB", "Intestatario", "Indirizzo"]
+bonifici = bonifici.drop(useless_features, axis=1)
+segnalaz = segnalaz.drop(useless_features, axis=1)
+bonifici = bonifici.drop(["DataValuta", "DataEsecuzione", "MsgErrore", "Nominativo", "TipoOperazione"], axis=1)
+segnalaz = segnalaz.drop(["DataValuta", "DataEsecuzione", "MsgErrore", "Nominativo", "TipoOperazione"], axis=1)
+
+# datasets merge into bonifici
+bonifici["isFraud"] = np.zeros(len(bonifici.index))
+for index, row in segnalaz.iterrows():
+    if index in bonifici.index:
+        bonifici.loc[index, "isFraud"] = 1
+    else:
+        # print(index)
+        bonifici.append(row)
+bonifici["isFraud"] = pd.to_numeric(bonifici["isFraud"], downcast='integer')
+
+bonifici.Timestamp = pd.to_datetime(bonifici.Timestamp)
+bonifici.NumConfermaSMS = bonifici.NumConfermaSMS.eq('Si').astype(int)
+
+# rescaling "Importo"
+x = bonifici[["Importo"]].to_numpy()
+min_max_scaler = preprocessing.MinMaxScaler()
+x_scaled = min_max_scaler.fit_transform(x)
+bonifici[["Importo"]] = x_scaled
+
+# creating "isItalianSender" and "isItalianReceiver"
+bonifici.loc[:, "isItalianSender"] = np.ones(len(bonifici.index))
+bonifici.loc[:, "isItalianReceiver"] = np.ones(len(bonifici.index))
+for index, row in bonifici[["CC_ASN", "IBAN_CC"]].iterrows():
+    if row["CC_ASN"][:2] != "IT":
+        bonifici.at[index, "isItalianSender"] = 0
+    if row["IBAN_CC"] != "IT":
+        bonifici.at[index, "isItalianReceiver"] = 0
+bonifici["isItalianSender"] = pd.to_numeric(bonifici["isItalianSender"], downcast='integer')
+bonifici["isItalianReceiver"] = pd.to_numeric(bonifici["isItalianReceiver"], downcast='integer')
+
+# saving the dataset
+bonifici.to_csv("datasets/bonifici_engineered.csv")
\ No newline at end of file
diff --git a/metrics.py b/metrics.py
new file mode 100644
index 0000000..4ac14e7
--- /dev/null
+++ b/metrics.py
@@ -0,0 +1,21 @@
+from keras import backend as K
+
+
+def recall_m(y_true, y_pred):
+    true_positives = K.sum(K.round(K.clip(y_true * y_pred, 0, 1)))
+    possible_positives = K.sum(K.round(K.clip(y_true, 0, 1)))
+    recall = true_positives / (possible_positives + K.epsilon())
+    return recall
+
+
+def precision_m(y_true, y_pred):
+    true_positives = K.sum(K.round(K.clip(y_true * y_pred, 0, 1)))
+    predicted_positives = K.sum(K.round(K.clip(y_pred, 0, 1)))
+    precision = true_positives / (predicted_positives + K.epsilon())
+    return precision
+
+
+def f1_m(y_true, y_pred):
+    precision = precision_m(y_true, y_pred)
+    recall = recall_m(y_true, y_pred)
+    return 2 * ((precision * recall) / (precision + recall + K.epsilon()))
\ No newline at end of file
diff --git a/models/LSTM.py b/models/LSTM.py
index 8db9d7f..76d5f16 100644
--- a/models/LSTM.py
+++ b/models/LSTM.py
@@ -4,27 +4,29 @@ from keras.layers.recurrent import LSTM
 from keras.models import Sequential
 from keras.layers.wrappers import TimeDistributed
 from keras.optimizers import Adam, RMSprop
-
 from keras.callbacks import EarlyStopping, Callback, TensorBoard, ModelCheckpoint
 import keras.backend as K
 import shutil
 import os
+import wandb
+from wandb.keras import WandbCallback
+wandb.init(project="fraud-detection-thesis")
 
 
 class VanillaLSTM(object):
-    #layers = {input: 1, 2: 64, 3: 256, 4: 100, output: 1}
+    # layers = {input: 1, 2: 64, 3: 256, 4: 100, output: 1}
     def __init__(self, look_back, layers, dropout, loss, learning_rate):
         self.look_back = look_back
         self.n_hidden = len(layers) - 2
         self.model = Sequential()
         self.layers = layers
         self.loss = loss
-        #self.optimizer = optimizer
+        # self.optimizer = optimizer
         self.learning_rate = learning_rate
         self.dropout = dropout
 
     def build_model(self):
-        #first add input to hidden1
+        # first add input to hidden1
         self.model.add(LSTM(
             self.layers['input'],
             input_shape=(self.look_back, self.layers['input']),
@@ -38,29 +40,59 @@ class VanillaLSTM(object):
         # add output
         self.model.add(Dense(self.layers['output']))
 
-        #compile model and print summary
+        # compile model and print summary
         self.model.compile(loss=self.loss, optimizer=Adam(lr=self.learning_rate))
         self.model.summary()
         return self.model
 
 
-def train_model(model, x_train, y_train, batch_size, epochs, shuffle, validation, validation_data, patience):
-    print("Training")
+class LstmClassifier(object):
+    def __init__(self, look_back, layers, dropout, loss, learning_rate, num_features, metrics):
+        self.look_back = look_back
+        self.n_hidden = len(layers) - 2
+        self.model = Sequential()
+        self.layers = layers
+        self.loss = loss
+        # self.optimizer = optimizer
+        self.learning_rate = learning_rate
+        self.dropout = dropout
+        self.num_features = num_features
+        self.metrics = metrics
+
+    def build_model(self):
+        # first add input to hidden1
+        self.model.add(LSTM(
+            self.layers['input'],
+            input_shape=(self.look_back + 1, self.num_features),
+            return_sequences=True,
+            ))
+
+        self.model.add(LSTM(self.layers['hidden1'], return_sequences=False))
+
+        # add output
+        self.model.add(Dense(self.layers['output'], activation='sigmoid'))
+
+        # compile model and print summary
+        self.model.compile(loss=self.loss, optimizer=Adam(lr=self.learning_rate), metrics=self.metrics)
+        # self.model.summary()
+        return self.model
+
+
+def train_model(model, x_train, y_train, batch_size, epochs, shuffle=False, validation=False, patience=0):
+    print("Training...")
     training_start_time = time.time()
-    # tensorboard = TensorBoard(log_dir='/home/esihakh/projects/github_thesis/lstm_anomaly_thesis/logs/tf_logs/', histogram_freq=5, write_graph=True, write_images=False)
+
     if validation:
         early_stopping = EarlyStopping(monitor='val_loss', patience=patience)
-
-        history_callback = model.fit(x_train, y_train, batch_size=batch_size, epochs=epochs,
-                                     validation_data=validation_data,
-                                     shuffle=shuffle, verbose=2, callbacks=[early_stopping])
+        history_callback = model.fit(x_train, y_train, batch_size=batch_size, epochs=epochs, shuffle=shuffle, verbose=2, callbacks=[early_stopping])
     else:
-        history_callback = model.fit(x_train, y_train, epochs=epochs, verbose=2)
-    print('Training duration (s) : %s', str(time.time() - training_start_time))
-    print("Training Loss per epoch: %s" % str(history_callback.history["loss"]))
+        history_callback = model.fit(x_train, y_train, epochs=epochs, verbose=2, callbacks=[WandbCallback()], shuffle=shuffle)
+        model.save(os.path.join(wandb.run.dir, "model.h5"))
+
+    print('Training done. Duration: ' + str(time.time() - training_start_time))
+    print("Training Loss per epoch: " + str(history_callback.history["loss"]))
     if validation:
         print("Validation  Loss per epoch: %s" % str(history_callback.history["val_loss"]))
-    print(history_callback.history.keys())
     return history_callback
     # for epoch in range(epochs):
     #     model.fit(x_train, y_train, batch_size=batch_size, epochs=1,shuffle=shuffle, verbose=2)
